---
interface Link {
  label: string;
  url: string;
}

interface Stat {
  label: string;
  value: number;
}

interface Props {
  id: string;
  title: string;
  tagline: string;
  accent: string;
  icon: string;
  experience: string;
  yearsActive: string;
  stats: Stat[];
  stack: string[];
  details: string[];
  employers: string[];
  links: Link[];
}

const {
  id,
  title,
  tagline,
  accent,
  icon,
  experience,
  yearsActive,
  stats,
  stack,
  details,
  employers,
  links,
} = Astro.props;

const isMonoIcon = icon === "\u03BB" || icon === ">_";
---
<div class="modal-overlay" id={`persona-modal-${id}`}>
  <div class="modal-panel" style={`border-color:${accent}40; box-shadow: 0 8px 48px ${accent}25;`} role="dialog" aria-label={title}>
    {/* Header */}
    <div class="modal-header" style={`border-bottom-color:${accent}15;`}>
      <div class="modal-header-row">
        <div
          class:list={["modal-icon", { "mono-icon": isMonoIcon }]}
          style={`background:${accent}15; border-color:${accent}33; color:${accent};`}
        >
          {icon}
        </div>
        <div>
          <h2 class="modal-title">{title}</h2>
          <p class="modal-tagline" style={`color:${accent};`}>"{tagline}"</p>
        </div>
      </div>
      <div class="modal-meta">
        <span>{experience}</span>
        <span class="meta-sep">&bull;</span>
        <span>{yearsActive}</span>
      </div>
    </div>

    {/* Stats */}
    <div class="modal-section">
      <div class="section-label">Stats</div>
      {stats.map((s) => (
        <div class="modal-stat-row">
          <span class="modal-stat-label">{s.label}</span>
          <div class="modal-stat-track">
            <div class="modal-stat-fill" style={`width:${s.value}%; background:${accent};`}></div>
          </div>
          <span class="modal-stat-value">{s.value}</span>
        </div>
      ))}
    </div>

    {/* Stack */}
    <div class="modal-section">
      <div class="section-label">Stack</div>
      <div class="modal-stack">
        {stack.map((t) => (
          <span
            class="modal-stack-badge"
            style={`background:${accent}15; color:${accent}; border-color:${accent}30;`}
          >
            {t}
          </span>
        ))}
      </div>
    </div>

    {/* Field Notes */}
    <div class="modal-section">
      <div class="section-label field-notes-label" style={`color:${accent};`}>Field Notes</div>
      {details.map((d) => (
        <div class="field-note" style={`background:${accent}08; border-color:${accent}12;`}>
          <div class="note-dot" style={`background:${accent};`}></div>
          <span>{d}</span>
        </div>
      ))}
    </div>

    {/* Employers */}
    <div class="modal-section">
      <div class="section-label">Employers</div>
      <div class="modal-employers">{employers.join(" \u2022 ")}</div>
    </div>

    {/* Links */}
    {links.length > 0 && (
      <div class="modal-section modal-links">
        {links.map((l) => (
          <a
            href={l.url}
            target="_blank"
            rel="noopener noreferrer"
            class="modal-link"
            style={`color:${accent}; background:${accent}12; border-color:${accent}25;`}
          >
            {l.label} &rarr;
          </a>
        ))}
      </div>
    )}

    {/* Close button */}
    <button
      class="modal-close"
      data-modal-close
      style={`border-top-color:${accent}15; background:${accent}06;`}
    >
      &#10005; close
    </button>
  </div>
</div>

<style>
  .modal-panel {
    width: clamp(20rem, 90vw, 28.75rem);
    max-width: 95vw;
    max-height: 90vh;
    overflow-y: auto;
    background: linear-gradient(135deg, #0c0c14 0%, #14141e 100%);
    border-radius: 16px;
    border: 1px solid;
  }

  .modal-header {
    padding: 22px 26px 14px;
    border-bottom: 1px solid;
  }

  .modal-header-row {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-bottom: 8px;
  }

  .modal-icon {
    width: 44px;
    height: 44px;
    border-radius: 10px;
    border: 1px solid;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.375rem;
    flex-shrink: 0;
  }

  .modal-icon.mono-icon {
    font-size: 1rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
  }

  .modal-title {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 700;
    color: #fff;
  }

  .modal-tagline {
    margin: 2px 0 0;
    font-size: 0.8125rem;
    font-style: italic;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    opacity: 0.8;
  }

  .modal-meta {
    display: flex;
    gap: 10px;
    font-size: 0.8125rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    color: #666;
  }

  .meta-sep {
    color: #333;
  }

  .modal-section {
    padding: 14px 26px;
  }

  .modal-section:first-of-type {
    padding-top: 14px;
  }

  .section-label {
    font-size: 0.8125rem;
    color: #555;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin-bottom: 6px;
  }

  .field-notes-label {
    /* color override via inline style */
  }

  .modal-stat-row {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 3px;
  }

  .modal-stat-label {
    font-size: 0.8125rem;
    color: #888;
    width: 70px;
    text-align: right;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    flex-shrink: 0;
  }

  .modal-stat-track {
    flex: 1;
    height: 5px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 3px;
    overflow: hidden;
  }

  .modal-stat-fill {
    height: 100%;
    border-radius: 3px;
  }

  .modal-stat-value {
    font-size: 0.8125rem;
    color: #555;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    width: 18px;
  }

  .modal-stack {
    line-height: 1.7;
  }

  .modal-stack-badge {
    display: inline-block;
    font-size: 0.8125rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    padding: 2px 5px;
    border-radius: 2px;
    margin-right: 3px;
    margin-bottom: 2px;
    border: 1px solid;
  }

  .field-note {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    margin-bottom: 5px;
    padding: 5px 10px;
    border-radius: 5px;
    border: 1px solid;
  }

  .note-dot {
    width: 3px;
    height: 3px;
    border-radius: 50%;
    flex-shrink: 0;
    margin-top: 5px;
  }

  .field-note span {
    font-size: 0.8125rem;
    color: #ccc;
    line-height: 1.4;
  }

  .modal-employers {
    font-size: 0.8125rem;
    color: #aaa;
    line-height: 1.5;
  }

  .modal-links {
    padding-bottom: 18px;
  }

  .modal-link {
    display: inline-block;
    font-size: 0.8125rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    padding: 4px 10px;
    border-radius: 4px;
    border: 1px solid;
    cursor: pointer;
    text-decoration: none;
    margin-right: 6px;
    transition: opacity 0.15s;
  }

  .modal-link:hover {
    opacity: 0.8;
  }

  .modal-close {
    width: 100%;
    padding: 10px 0;
    text-align: center;
    cursor: pointer;
    border-top: 1px solid;
    border-left: none;
    border-right: none;
    border-bottom: none;
    border-radius: 0 0 16px 16px;
    font-size: 0.8125rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    color: #555;
    transition: color 0.15s;
  }

  .modal-close:hover {
    color: #aaa;
  }
</style>
