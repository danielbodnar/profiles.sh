---
interface Stat {
  label: string;
  value: number;
}

interface Props {
  id: string;
  title: string;
  shortTitle: string;
  tagline: string;
  accent: string;
  icon: string;
  experience: string;
  yearsActive: string;
  stats: Stat[];
  stack: string[];
  details: string[];
  employers: string[];
}

const {
  id,
  title,
  shortTitle,
  tagline,
  accent,
  icon,
  experience,
  yearsActive,
  stats,
  stack,
  details,
  employers,
} = Astro.props;

const isMonoIcon = icon === "\u03BB" || icon === ">_";

function contrastText(hex: string): string {
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  return (0.299 * r + 0.587 * g + 0.114 * b) / 255 > 0.45 ? "#0a0a0f" : "#f0f0f5";
}

const txtColor = contrastText(accent);
---
<div class="persona-card" data-persona-id={id}>
  <div class="card-top" style={`border-color:${accent}15;`}>
    <div class="accent-bar" style={`background:${accent}; opacity:0.4;`}></div>
    <div class="card-content">
      {/* Header row: icon + name */}
      <div class="card-header">
        <div
          class="card-icon"
          class:list={[{ "mono-icon": isMonoIcon }]}
          style={`background:${accent}12; border-color:${accent}25; color:${accent};`}
        >
          {icon}
        </div>
        <div class="card-title-block">
          <div class="card-short-title">{shortTitle}</div>
          <div class="card-exp">{experience} &middot; {yearsActive}</div>
        </div>
      </div>

      {/* Tagline */}
      <p class="card-tagline" style={`color:${accent};`}>"{tagline}"</p>

      {/* Stats */}
      <div class="card-stats">
        {stats.map((s) => (
          <div class="stat-row">
            <span class="stat-label">{s.label}</span>
            <div class="stat-track">
              <div class="stat-fill" style={`width:${s.value}%; background:${accent};`}></div>
            </div>
            <span class="stat-value">{s.value}</span>
          </div>
        ))}
      </div>

      {/* Stack badges */}
      <div class="card-stack">
        {stack.map((t) => (
          <span class="stack-badge" style={`background:${accent}15; color:${accent}; border-color:${accent}30;`}>
            {t}
          </span>
        ))}
      </div>

      {/* Detail items */}
      <div class="card-details">
        {details.map((d) => (
          <div class="detail-item" style={`border-left-color:${accent}25;`}>{d}</div>
        ))}
      </div>

      {/* Employers */}
      <div class="card-employers">{employers.join(" \u2022 ")}</div>
    </div>
  </div>
  <button
    class="card-button"
    style={`background:${accent}; color:${txtColor};`}
    data-persona-open={id}
  >
    &#8599; open details &#8601;
  </button>
</div>

<style>
  .persona-card {
    min-width: 17rem;
    flex: 1 1 17rem;
    max-width: 24rem;
    display: flex;
    flex-direction: column;
  }

  .card-top {
    flex: 1;
    background: linear-gradient(135deg, #0c0c14 0%, #111119 100%);
    border-radius: 8px 8px 0 0;
    border: 1px solid;
    border-bottom: none;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
    overflow: hidden;
    transition: border-color 0.2s;
  }

  .persona-card:hover .card-top {
    border-color: rgba(255, 255, 255, 0.15);
  }

  .accent-bar {
    height: 2px;
    width: 100%;
  }

  .card-content {
    padding: 12px 14px 12px;
  }

  .card-header {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 8px;
  }

  .card-icon {
    width: 24px;
    height: 24px;
    border-radius: 5px;
    flex-shrink: 0;
    border: 1px solid;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8125rem;
  }

  .card-icon.mono-icon {
    font-size: 0.8125rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
  }

  .card-title-block {
    min-width: 0;
  }

  .card-short-title {
    font-size: 0.8125rem;
    font-weight: 700;
    color: #ddd;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .card-exp {
    font-size: 0.8125rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    color: #555;
    margin-top: 1px;
  }

  .card-tagline {
    margin: 0 0 8px;
    font-size: 0.8125rem;
    font-style: italic;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    opacity: 0.7;
    line-height: 1.3;
  }

  .card-stats {
    margin-bottom: 6px;
  }

  .stat-row {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 3px;
  }

  .stat-label {
    font-size: 0.8125rem;
    color: #777;
    width: 72px;
    text-align: right;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    flex-shrink: 0;
  }

  .stat-track {
    flex: 1;
    height: 5px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 2px;
    overflow: hidden;
  }

  .stat-fill {
    height: 100%;
    border-radius: 2px;
  }

  .stat-value {
    font-size: 0.8125rem;
    color: #444;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    width: 14px;
  }

  .card-stack {
    margin-top: 8px;
    line-height: 1.6;
  }

  .stack-badge {
    display: inline-block;
    font-size: 0.8125rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    padding: 1px 5px;
    border-radius: 3px;
    margin-right: 3px;
    margin-bottom: 2px;
    border: 1px solid;
  }

  .card-details {
    margin-top: 8px;
  }

  .detail-item {
    font-size: 0.8125rem;
    color: #888;
    line-height: 1.4;
    margin-bottom: 3px;
    padding-left: 6px;
    border-left: 2px solid;
  }

  .card-employers {
    margin-top: 8px;
    font-size: 0.8125rem;
    color: #666;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
  }

  .card-button {
    width: 100%;
    padding: 5px 0;
    border-radius: 0 0 8px 8px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8125rem;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    font-weight: 700;
    letter-spacing: 1px;
    transition: filter 0.15s;
    filter: brightness(0.85);
  }

  .card-button:hover {
    filter: brightness(1.15);
  }
</style>
