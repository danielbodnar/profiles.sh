---
interface Axis {
  label: string;
  value: number;
  color: string;
}

interface Props {
  axes: Axis[];
  size?: number;
}

const { axes, size = 320 } = Astro.props;

const cx = size / 2;
const cy = size / 2;
const r = size * 0.38;
const n = axes.length;
const angleStep = (2 * Math.PI) / n;
const offset = -Math.PI / 2;

function point(i: number, val: number): [number, number] {
  const a = offset + i * angleStep;
  const dist = (val / 100) * r;
  return [cx + dist * Math.cos(a), cy + dist * Math.sin(a)];
}

// Grid polygons at 25%, 50%, 75%, 100%
const gridPolygons = [25, 50, 75, 100].map((pct) => {
  const pts: [number, number][] = [];
  for (let i = 0; i < n; i++) pts.push(point(i, pct));
  return pts.map((p) => `${p[0]},${p[1]}`).join(" ");
});

// Axis lines (center to 100% for each axis)
const axisEndpoints = axes.map((_, i) => point(i, 100));

// Data polygon
const dataPoints = axes.map((a, i) => point(i, a.value));
const dataPath = dataPoints.map((p) => `${p[0]},${p[1]}`).join(" ");

// Label positions at 112% radius
const labelPositions = axes.map((_, i) => point(i, 112));
---
<div class="radar-container">
  <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} class="radar-svg">
    {/* Grid polygons */}
    {gridPolygons.map((pts) => (
      <polygon points={pts} fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="1" />
    ))}

    {/* Axis lines */}
    {axisEndpoints.map((ep) => (
      <line x1={cx} y1={cy} x2={ep[0]} y2={ep[1]} stroke="rgba(255,255,255,0.04)" stroke-width="1" />
    ))}

    {/* Data polygon */}
    <polygon points={dataPath} fill="rgba(100,200,255,0.12)" stroke="rgba(100,200,255,0.6)" stroke-width="1.5" />

    {/* Data points and labels */}
    {axes.map((axis, i) => {
      const dp = dataPoints[i];
      const lp = labelPositions[i];
      let anchor = "middle";
      if (lp[0] < cx - 10) anchor = "end";
      if (lp[0] > cx + 10) anchor = "start";
      return (
        <g>
          <circle cx={dp[0]} cy={dp[1]} r={3} fill={axis.color} />
          <text
            x={lp[0]}
            y={lp[1]}
            text-anchor={anchor}
            dominant-baseline="middle"
            style={`font-size:9px;fill:${axis.color};font-family:"SF Mono","Cascadia Code","Fira Code",Consolas,monospace;`}
          >
            {axis.label}
          </text>
          <text
            x={dp[0]}
            y={dp[1] - 8}
            text-anchor="middle"
            style="font-size:8px;fill:#888;font-family:'SF Mono','Cascadia Code','Fira Code',Consolas,monospace;"
          >
            {axis.value}
          </text>
        </g>
      );
    })}
  </svg>
  <div class="radar-caption">SKILL RADAR</div>
</div>

<style>
  .radar-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 24px auto 8px;
  }

  .radar-svg {
    max-width: 100%;
    height: auto;
  }

  .radar-caption {
    font-size: 0.8125rem;
    color: #444;
    font-family: "SF Mono", "Cascadia Code", "Fira Code", Consolas, monospace;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 4px;
  }
</style>
